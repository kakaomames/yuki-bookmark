<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å­¦è©¦é¨“å¯¾ç­–å•é¡Œã¨è§£èª¬å‹•ç”»ã®è¡¨ç¤º</title>
    <link rel="icon" href="https://kakaomames.github.io/rei/logo.png">
    
    <meta name="description" content="Gemini programmingéšŠ ç‰¹è£½ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼šoisogiã‚¹ã‚­ãƒ£ãƒ³å®Ÿè£…æ¸ˆã€‚å¤§å­¦è©¦é¨“å¯¾ç­–ã®è§£èª¬å‹•ç”»ã‚’çˆ†é€Ÿã§å±•é–‹ï¼">
    <meta property="og:image" content="https://kakaomames.github.io/rei/logo.png">
    <style>
        body { background-color: #0f0f0f; color: #f1f1f1; font-family: 'Helvetica Neue', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background-color: #1e1e1e; padding: 30px; border-radius: 12px; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.7); max-width: 850px; width: 100%; box-sizing: border-box; border: 1px solid #333; }
        h2 { color: #ff0000; text-align: center; text-shadow: 0 0 10px rgba(255,0,0,0.3); }
        
        input[type="text"] { width: 100%; padding: 15px; border: 2px solid #333; background: #000; color: #fff; border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; }
        
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        #launch-btn { background-color: #ff0000; color: white; }
        #mode-toggle-btn { background-color: #444; color: white; }

        #player-section { display: none; width: 100%; margin-top: 20px; }
        .yt-container { position: relative; background: #000; border-radius: 10px; overflow: hidden; aspect-ratio: 16 / 9; border: 1px solid #444; }
        video { width: 100%; height: 100%; }

        .yt-controls { position: absolute; bottom: 0; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.9)); padding: 15px; box-sizing: border-box; opacity: 1; transition: 0.3s; }
        .hidden-ui { display: none !important; }

        .progress-area { height: 6px; background: rgba(255,255,255,0.2); margin-bottom: 12px; cursor: pointer; position: relative; }
        .progress-bar { height: 100%; background: #f00; width: 0%; }
        
        .yt-menu { position: absolute; bottom: 60px; right: 15px; background: rgba(30,30,30,0.95); border-radius: 8px; padding: 10px; list-style: none; display: none; z-index: 100; border: 1px solid #ff0000; cursor: pointer; max-height: 200px; overflow-y: auto;}
        .yt-menu li { padding: 8px 15px; transition: 0.2s; border-bottom: 1px solid #333; }
        .yt-menu li:hover { background: #ff0000; color: #fff; }
        .yt-menu.show { display: block; }

        #log-panel { margin-top: 15px; background: #000; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; color: #00ff00; border: 1px solid #333; max-height: 100px; overflow-y: auto; width: 100%; }
        
        .quick-quality-bar { margin-top: 15px; display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; padding: 10px; background: #252525; border-radius: 8px; border: 1px dashed #444; }
        .q-btn { background: #333; color: #fff; border: 1px solid #555; padding: 6px 12px; font-size: 12px; border-radius: 4px; cursor: pointer; transition: 0.2s; }
        .q-btn:hover { background: #ff0000; border-color: #ff0000; }
        .q-btn.active { background: #ff0000; border-color: #fff; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸš€ Gemini ProgrammingéšŠ çµ±åˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h2>
        
        <input type="text" id="youtubeLink" placeholder="å‹•ç”»URLã¾ãŸã¯IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" value="">
        <div class="btn-group">
            <button id="launch-btn">æ¢æ¤œé–‹å§‹ï¼ˆoisogiï¼ï¼‰</button>
            <button id="mode-toggle-btn">ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿: YouTubeé¢¨</button>
        </div>

        <div id="player-section">
            <div class="yt-container" id="yt-player-box">
                <video id="main-video" playsinline></video>
                <div class="yt-controls" id="custom-ui">
                    <div class="progress-area" id="progress-area"><div class="progress-bar" id="progress-bar"></div></div>
                    <div style="display:flex; justify-content: space-between; align-items: center;">
                        <div>
                            <button id="play-pause" style="background:none; border:none; color:#fff; font-size:20px; cursor:pointer;">â–¶</button>
                            <span id="time-display" style="margin-left:10px; font-size: 14px;">0:00 / 0:00</span>
                        </div>
                        <button id="settings-btn" style="background:#ff0000; color:#fff; border:none; padding:5px 12px; border-radius:4px; cursor:pointer; font-weight:bold;">âš™ ç”»è³ª</button>
                    </div>
                </div>
                <ul id="quality-menu" class="yt-menu"></ul>
            </div>
            
            <div id="quick-quality" class="quick-quality-bar"></div>
            
            <div id="log-panel">ğŸ“¡ ãƒ­ã‚°å¾…æ©Ÿä¸­...</div>
        </div>
    </div>

<script>
let audioTrack = new Audio();
let isCustomMode = true;
let currentStreams = []; // ç¾åœ¨å–å¾—ã§ãã¦ã„ã‚‹ç”»è³ªãƒªã‚¹ãƒˆ
const video = document.getElementById('main-video');
const logPanel = document.getElementById('log-panel');
const quickQualityBar = document.getElementById('quick-quality');

function missionLog(t, m) {
    const entry = `[${t}] ${m}`;
    console.log(entry);
    const line = document.createElement('div');
    line.textContent = entry;
    logPanel.prepend(line);
}

document.getElementById('mode-toggle-btn').onclick = () => {
    isCustomMode = !isCustomMode;
    const modeName = isCustomMode ? "YouTubeé¢¨" : "æ¨™æº–Videoã‚¿ã‚°";
    document.getElementById('mode-toggle-btn').innerText = `ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿: ${modeName}`;
    if(isCustomMode) {
        video.removeAttribute('controls');
        document.getElementById('custom-ui').classList.remove('hidden-ui');
    } else {
        video.setAttribute('controls', 'true');
        document.getElementById('custom-ui').classList.add('hidden-ui');
    }
    missionLog("MODE", `ãƒ¢ãƒ¼ãƒ‰ï¼š${modeName}`);
};

function extractVideoId(url) {
    const match = url.match(/(?:v=|\/embed\/|\/watch\?v=|\/v\/|\/e\/|youtu\.be\/|project\/|https:\/\/www\.youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/);
    return (match && match[1]) ? match[1] : (url.length === 11 ? url : null);
}

async function startAdventure(videoId) {
    missionLog("SYSTEM", "ğŸš€ æ–°ãŸãªå†’é™ºã¸å‡ºç™ºï¼ãƒªã‚»ãƒƒãƒˆé–‹å§‹...");
    
    // --- å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆ ---
    video.pause();
    audioTrack.pause();
    video.src = "";
    audioTrack.src = "";
    video.load();
    video.currentTime = 0;
    audioTrack.currentTime = 0;
    currentStreams = [];
    
    document.getElementById('player-section').style.display = 'block';
    quickQualityBar.innerHTML = '<span style="color:#ff0000;">âš¡ oisogi ã‚¹ã‚­ãƒ£ãƒ³ä¸­...</span>';

    // 1. oisogiï¼ˆé«˜é€Ÿå†ç”Ÿï¼‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    const oisogiUrl = `https://xeroxapp032.vercel.app/api/v1/oisogi/${videoId}`;
    // 2. æ¨™æº–ï¼ˆå…¨ç”»è³ªå–å¾—ï¼‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    const fullUrl = `https://xeroxapp032.vercel.app/api/v1/${videoId}`;

    // ã¾ãš oisogi ã‚’æœ€å„ªå…ˆã§å–å¾—
    fetch(oisogiUrl)
        .then(r => r.json())
        .then(data => {
            if (data.streams) {
                missionLog("OISOGI", "çˆ†é€Ÿãƒ‡ãƒ¼ã‚¿åˆ°ç€ï¼å†ç”Ÿæº–å‚™...");
                updateStreams(data.streams.video);
                if (!video.src) { // ã¾ã ä½•ã‚‚å†ç”Ÿã•ã‚Œã¦ãªã‘ã‚Œã°
                    playStream(data.streams.video[0].url, data.streams.audio ? data.streams.audio[0].url : null);
                }
            }
        })
        .catch(e => missionLog("ERROR", "oisogiå¤±æ•—"));

    // æ¬¡ã«æ¨™æº–APIã‚’å¾…æ©Ÿï¼ˆç”»è³ªãƒªã‚¹ãƒˆè£œå®Œç”¨ï¼‰
    fetch(fullUrl)
        .then(r => r.json())
        .then(data => {
            if (data.streams) {
                missionLog("NETWORK", "æ¨™æº–ãƒ‡ãƒ¼ã‚¿(å…¨ç”»è³ª)ãŒåˆæµã—ãŸãï¼");
                updateStreams(data.streams.video);
            }
        })
        .catch(e => missionLog("ERROR", "æ¨™æº–APIã‚¹ã‚­ãƒ£ãƒ³å¤±æ•—"));
}

function updateStreams(newStreams) {
    // é‡è¤‡ã‚’é¿ã‘ã¦ãƒãƒ¼ã‚¸
    newStreams.forEach(ns => {
        if (!currentStreams.find(cs => cs.qualityLabel === ns.qualityLabel)) {
            currentStreams.push(ns);
        }
    });
    // ç”»è³ªã®é«˜ã„é †ã«ã‚½ãƒ¼ãƒˆ
    currentStreams.sort((a, b) => (parseInt(b.height) || 0) - (parseInt(a.height) || 0));
    setupQualityMenu(currentStreams);
}

function playStream(vUrl, aUrl) {
    video.src = vUrl;
    if(aUrl) audioTrack.src = aUrl;
    
    video.load();
    if(aUrl) audioTrack.load();

    video.onloadedmetadata = () => {
        video.currentTime = 0;
        if(aUrl) audioTrack.currentTime = 0;
        video.play();
        missionLog("SYNC", "å†ç”Ÿã‚¹ã‚¿ãƒ¼ãƒˆ [0.00s]");
    };
}

function switchQuality(newUrl, btnElement) {
    const now = video.currentTime;
    const wasPlaying = !video.paused;
    missionLog("ACTION", `ç”»è³ªå¤‰æ›´ï¼š${now.toFixed(2)}s ã‹ã‚‰åŒæœŸä¸­...`);
    
    video.pause();
    audioTrack.pause();
    
    video.src = newUrl;
    video.load();
    
    // ãƒœã‚¿ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
    document.querySelectorAll('.q-btn').forEach(b => b.classList.remove('active'));
    if(btnElement) btnElement.classList.add('active');

    const onLoaded = () => {
        video.currentTime = now;
        audioTrack.currentTime = now;
        if(wasPlaying) {
            video.play();
            audioTrack.play();
        }
        missionLog("SYNC", "ç”»è³ªåˆ‡æ›¿ï¼†åŒæœŸæˆåŠŸï¼");
        video.removeEventListener('loadedmetadata', onLoaded);
    };
    video.addEventListener('loadedmetadata', onLoaded);
}

// --- åŒæœŸã‚¨ãƒ³ã‚¸ãƒ³ ---
video.onplay = () => { audioTrack.play(); document.getElementById('play-pause').innerText = 'â¸'; };
video.onpause = () => { audioTrack.pause(); document.getElementById('play-pause').innerText = 'â–¶'; };
video.onratechange = () => audioTrack.playbackRate = video.playbackRate;

video.onseeking = () => { audioTrack.currentTime = video.currentTime; };
video.onseeked = () => { audioTrack.currentTime = video.currentTime; };

// ã‚ºãƒ¬ç›£è¦–ï¼ˆ0.5ç§’ãŠãï¼‰
setInterval(() => {
    if(!video.paused && video.readyState >= 2) {
        const diff = Math.abs(video.currentTime - audioTrack.currentTime);
        if(diff > 0.15) {
            audioTrack.currentTime = video.currentTime;
            missionLog("DEBUG", "Syncè£œæ­£");
        }
    }
}, 500);

document.getElementById('launch-btn').onclick = () => {
    const id = extractVideoId(document.getElementById('youtubeLink').value);
    if(id) startAdventure(id);
    else missionLog("WARN", "IDãŒä¸æ­£ã ãï¼");
};

document.getElementById('play-pause').onclick = () => {
    if(video.paused) video.play();
    else video.pause();
};

video.ontimeupdate = () => {
    const p = (video.currentTime / video.duration) * 100;
    document.getElementById('progress-bar').style.width = (p || 0) + '%';
    document.getElementById('time-display').innerText = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
};

function formatTime(s) {
    if(!s || isNaN(s)) return "0:00";
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return `${m}:${sec < 10 ? '0' : ''}${sec}`;
}

function setupQualityMenu(streams) {
    const menu = document.getElementById('quality-menu');
    menu.innerHTML = '';
    quickQualityBar.innerHTML = '';

    streams.forEach((s) => {
        const label = s.qualityLabel || `${s.height}p`;
        
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”¨
        const li = document.createElement('li');
        li.innerText = label;
        li.onclick = () => { switchQuality(s.url, null); menu.classList.remove('show'); };
        menu.appendChild(li);

        // ã‚¯ã‚¤ãƒƒã‚¯ãƒœã‚¿ãƒ³ç”¨ï¼ˆãƒ“ãƒ‡ã‚ªã®ä¸‹ï¼‰
        const btn = document.createElement('button');
        btn.className = 'q-btn';
        if (video.src === s.url) btn.classList.add('active');
        btn.innerText = label;
        btn.onclick = () => switchQuality(s.url, btn);
        quickQualityBar.appendChild(btn);
    });
}

document.getElementById('settings-btn').onclick = (e) => {
    e.stopPropagation();
    document.getElementById('quality-menu').classList.toggle('show');
};

window.onclick = () => document.getElementById('quality-menu').classList.remove('show');

document.getElementById('progress-area').onclick = (e) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const pos = (e.clientX - rect.left) / rect.width;
    const target = pos * video.duration;
    video.currentTime = target;
    audioTrack.currentTime = target;
};
</script>
</body>
</html>
<!--<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å­¦è©¦é¨“å¯¾ç­–å•é¡Œã¨è§£èª¬å‹•ç”»ã®è¡¨ç¤º</title>
    <link rel="icon" href="https://kakaomames.github.io/rei/logo.png">
    
    <meta name="description" content="Gemini programmingéšŠ ç‰¹è£½ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼šoisogiã‚¹ã‚­ãƒ£ãƒ³å®Ÿè£…æ¸ˆ">
    <meta property="og:title" content="å¤§å­¦è©¦é¨“å¯¾ç­–å•é¡Œã¨è§£èª¬å‹•ç”»ã®è¡¨ç¤º">
    <meta property="og:image" content="https://kakaomames.github.io/rei/logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <style>
        body { background-color: #0f0f0f; color: #f1f1f1; font-family: 'Helvetica Neue', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background-color: #1e1e1e; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); max-width: 850px; width: 100%; box-sizing: border-box; }
        h1, h2 { color: #ff0000; text-align: center; }
        h1 a { color: #ff0000; text-decoration: none; font-size: 0.8em; }
        
        .form-group { margin-bottom: 20px; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #333; background: #000; color: #fff; border-radius: 6px; box-sizing: border-box; }
        button#launch-btn { background-color: #ff0000; color: white; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: bold; width: 100%; transition: 0.3s; }
        button#launch-btn:hover { background-color: #cc0000; }

        #player-section { display: none; width: 100%; margin-top: 30px; }
        .yt-container { position: relative; background: #000; border-radius: 8px; overflow: hidden; aspect-ratio: 16 / 9; }
        video { width: 100%; height: 100%; display: block; }

        .yt-controls { position: absolute; bottom: 0; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.8)); padding: 10px; box-sizing: border-box; opacity: 0; transition: 0.3s; }
        .yt-container:hover .yt-controls { opacity: 1; }
        
        .progress-area { height: 5px; background: rgba(255,255,255,0.2); margin-bottom: 10px; cursor: pointer; position: relative; }
        .progress-bar { height: 100%; background: #f00; width: 0%; }
        
        .bottom-controls { display: flex; align-items: center; justify-content: space-between; }
        .left-controls, .right-controls { display: flex; align-items: center; gap: 15px; }
        .control-btn { background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 5px; }
        
        .volume-container { display: flex; align-items: center; gap: 5px; }
        #volume-slider { width: 0; transition: 0.2s; cursor: pointer; accent-color: #fff; }
        .volume-container:hover #volume-slider { width: 60px; }
        
        .yt-menu { position: absolute; bottom: 60px; right: 10px; background: rgba(28,28,28,0.95); border-radius: 8px; padding: 10px; list-style: none; display: none; z-index: 10; border: 1px solid #444; max-height: 200px; overflow-y: auto; }
        .yt-menu.show { display: block; }
        .yt-menu li { padding: 8px 15px; cursor: pointer; font-size: 14px; color: #fff; border-bottom: 1px solid #333; }
        .yt-menu li:hover { background: rgba(255,255,255,0.1); }

        #loading-area { display: none; margin-top: 20px; text-align: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid #ff0000; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <h1><a href="./y">æ­£è¦å“ã«æˆ»ã‚‹(ã“ã‚Œã¯è©¦ä½œå“ã§ã™)</a></h1>
        <h2>ğŸš€ Gemini ProgrammingéšŠ çµ±åˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h2>
        
        <div class="form-group">
            <input type="text" id="youtubeLink" placeholder="å‹•ç”»URLã¾ãŸã¯IDã‚’å…¥åŠ›" value="">
        </div>
        <button id="launch-btn">æ¢æ¤œé–‹å§‹ï¼ˆã‚¹ã‚­ãƒ£ãƒ³å®Ÿè¡Œï¼‰</button>

        <div id="loading-area">
            <div class="spinner"></div>
            <p id="status-msg">ç´¢æ•µä¸­...</p>
        </div>

        <div id="player-section">
            <div class="yt-container" id="yt-player-box">
                <video id="main-video" playsinline></video>
                <div class="yt-controls">
                    <div class="progress-area" id="progress-area"><div class="progress-bar" id="progress-bar"></div></div>
                    <div class="bottom-controls">
                        <div class="left-controls">
                            <button class="control-btn" id="play-pause">â–¶</button>
                            <div class="volume-container">
                                <button class="control-btn" id="mute-btn">ğŸ”Š</button>
                                <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="1">
                            </div>
                            <span id="time-display" style="font-size: 13px;">0:00 / 0:00</span>
                        </div>
                        <div class="right-controls">
                            <button class="control-btn" id="settings-btn">âš™ï¸</button>
                            <button class="control-btn" id="fullscreen-btn">ğŸ”³</button>
                        </div>
                    </div>
                </div>
                <ul id="quality-menu" class="yt-menu"></ul>
            </div>
            <p id="api-status" style="font-size: 12px; color: #888; margin-top: 10px; text-align: center;">âš¡ oisogiãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•å®Œäº†ã€‚è©³ç´°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­...</p>
        </div>
    </div>

<script>
let audioTrack = new Audio();
const video = document.getElementById('main-video');
const playBtn = document.getElementById('play-pause');
const volSlider = document.getElementById('volume-slider');
const muteBtn = document.getElementById('mute-btn');
const progressArea = document.getElementById('progress-area');
const progressBar = document.getElementById('progress-bar');
const timeDisplay = document.getElementById('time-display');
const loadingArea = document.getElementById('loading-area');
const playerSection = document.getElementById('player-section');
const statusMsg = document.getElementById('status-msg');
const qualityMenu = document.getElementById('quality-menu');
const apiStatus = document.getElementById('api-status');

function missionLog(t, m) { console.log(`[${t}] ${m}`); }

function extractVideoId(url) {
    if(!url) return null;
    const match = url.match(/(?:v=|\/embed\/|\/watch\?v=|\/v\/|\/e\/|youtu\.be\/|project\/|https:\/\/www\.youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/);
    return (match && match[1]) ? match[1] : (url.length === 11 ? url : null);
}

document.getElementById('launch-btn').onclick = () => {
    const id = extractVideoId(document.getElementById('youtubeLink').value);
    if(id) startAdventure(id);
};

async function startAdventure(videoId) {
    missionLog("SYSTEM", "ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè£œè¶³ã€ã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹ï¼");
    playerSection.style.display = 'none';
    loadingArea.style.display = 'block';
    statusMsg.innerText = `ğŸ“¡ ç¬¬1æ®µéšï¼šoisogiã‚¹ã‚­ãƒ£ãƒ³ä¸­...`;

    try {
        // ç¬¬1æ®µéšï¼šçˆ†é€Ÿå†ç”Ÿç”¨
        const resFast = await fetch(`https://xeroxapp032.vercel.app/api/v1/oisogi/${videoId}`);
        const dataFast = await resFast.json();
        if(!dataFast.streams.video.length) throw new Error("ã‚¹ãƒˆãƒªãƒ¼ãƒ ãªã—");

        loadingArea.style.display = 'none';
        playerSection.style.display = 'block';
        
        video.src = dataFast.streams.video[0].url;
        audioTrack.src = dataFast.streams.audio[0] ? dataFast.streams.audio[0].url : "";
        video.load();
        audioTrack.load();
        setupQualityMenu(dataFast.streams.video); // æš«å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼

        // ç¬¬2æ®µéšï¼šå…¨ç”»è³ªãƒªã‚¹ãƒˆã‚’è£ã§å–å¾—
        apiStatus.innerText = "ğŸ” ç¬¬2æ®µéšï¼šå…¨ç”»è³ªãƒªã‚¹ãƒˆã‚’è£ã§å–å¾—ä¸­...";
        fetch(`https://xeroxapp032.vercel.app/api/v1/${videoId}`)
            .then(res => res.json())
            .then(dataFull => {
                if(dataFull.streams && dataFull.streams.video) {
                    setupQualityMenu(dataFull.streams.video); // æœ¬å‘½ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æ›´æ–°
                    apiStatus.innerText = "âœ… å…¨ç”»è³ªã‚¹ã‚­ãƒ£ãƒ³å®Œäº†ã€‚å¤‰æ›´å¯èƒ½ã§ã™ï¼";
                    missionLog("DATA", "å…¨åœ°å›³ãƒ‡ãƒ¼ã‚¿ã®åŒæœŸæˆåŠŸï¼");
                }
            })
            .catch(e => {
                apiStatus.innerText = "âš ï¸ è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ";
                missionLog("ERROR", "ç¬¬2æ®µéšå¤±æ•—");
            });

    } catch (e) {
        statusMsg.innerHTML = `<span style="color:red;">ğŸ’¥ ç´¢æ•µå¤±æ•—: ${e.message}</span>`;
    }
}

playBtn.onclick = () => {
    if(video.paused) { video.play(); audioTrack.play(); playBtn.textContent = 'â¸'; }
    else { video.pause(); audioTrack.pause(); playBtn.textContent = 'â–¶'; }
};

volSlider.oninput = (e) => {
    video.volume = audioTrack.volume = e.target.value;
    muteBtn.textContent = e.target.value == 0 ? 'ğŸ”‡' : 'ğŸ”Š';
};

progressArea.onclick = (e) => {
    const rect = progressArea.getBoundingClientRect();
    const target = (e.clientX - rect.left) / rect.width;
    video.currentTime = audioTrack.currentTime = target * video.duration;
};

video.ontimeupdate = () => {
    progressBar.style.width = (video.currentTime / video.duration) * 100 + '%';
    timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
    // åŒæœŸè£œæ­£
    if (Math.abs(video.currentTime - audioTrack.currentTime) > 0.3) {
        audioTrack.currentTime = video.currentTime;
    }
};

function formatTime(s) {
    if(isNaN(s)) return "0:00";
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return `${m}:${sec < 10 ? '0' : ''}${sec}`;
}

function setupQualityMenu(streams) {
    qualityMenu.innerHTML = '';
    streams.forEach(v => {
        const li = document.createElement('li');
        li.textContent = v.qualityLabel ? v.qualityLabel : `${v.itag}p`;
        li.onclick = () => {
            const now = video.currentTime;
            const isPlaying = !video.paused;
            video.src = v.url;
            video.currentTime = now;
            if(isPlaying) { video.play(); audioTrack.play(); }
            qualityMenu.classList.remove('show');
            missionLog("ACTION", `ç”»è³ªå¤‰æ›´: ${li.textContent}`);
        };
        qualityMenu.appendChild(li);
    });
}

document.getElementById('settings-btn').onclick = (e) => {
    e.stopPropagation();
    qualityMenu.classList.toggle('show');
};

document.addEventListener('click', () => qualityMenu.classList.remove('show'));

document.getElementById('fullscreen-btn').onclick = () => {
    const box = document.getElementById('yt-player-box');
    if (box.requestFullscreen) box.requestFullscreen();
    else if (box.webkitRequestFullscreen) box.webkitRequestFullscreen();
};

(function() {
    const v = new URLSearchParams(window.location.search).get('v');
    if(v) { document.getElementById('youtubeLink').value = v; startAdventure(v); }
})();
</script>
</body>
</html>
<!--<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å¤§å­¦è©¦é¨“å¯¾ç­–å•é¡Œã¨è§£èª¬å‹•ç”»ã®è¡¨ç¤º</title>
    <link rel="icon" href="https://kakaomames.github.io/rei/logo.png">
<!--    <style>
        body { background: #0f0f0f; color: white; font-family: Roboto, Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .yt-container { position: relative; width: 90%; max-width: 1000px; background: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        video { width: 100%; display: block; }
        
        /* YouTubeé¢¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .yt-controls { position: absolute; bottom: 0; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.7)); padding: 10px; box-sizing: border-box; opacity: 0; transition: opacity 0.2s; }
        .yt-container:hover .yt-controls { opacity: 1; }
        
        .progress-area { height: 4px; background: rgba(255,255,255,0.2); margin-bottom: 10px; cursor: pointer; position: relative; }
        .progress-bar { height: 100%; background: #f00; width: 0%; }
        
        .bottom-controls { display: flex; align-items: center; justify-content: space-between; }
        .left-controls, .right-controls { display: flex; align-items: center; gap: 15px; }
        
        button { background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 5px; }
        
        /* éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
        .volume-container { display: flex; align-items: center; gap: 5px; }
        #volume-slider { width: 0; transition: width 0.2s; cursor: pointer; accent-color: #fff; }
        .volume-container:hover #volume-slider { width: 60px; }
        
        .yt-menu { position: absolute; bottom: 50px; right: 10px; background: rgba(28,28,28,0.9); border-radius: 8px; padding: 10px; list-style: none; display: none; }
        .yt-menu.show { display: block; }
        .yt-menu li { padding: 8px 12px; cursor: pointer; font-size: 14px; }
        .yt-menu li:hover { background: rgba(255,255,255,0.1); }
    </style>
</head>
<body>
<h1><a href="./y">æ­£è¦å“ã«æˆ»ã‚‹(ã“ã‚Œã¯è©¦ä½œå“ã§ã™)</a></h1><br><br>
<div class="yt-container">
    <video id="main-video" playsinline></video>
    
    <div class="yt-controls">
        <div class="progress-area" id="progress-area"><div class="progress-bar" id="progress-bar"></div></div>
        
        <div class="bottom-controls">
            <div class="left-controls">
                <button id="play-pause">â–¶</button>
                <div class="volume-container">
                    <button id="mute-btn">ğŸ”Š</button>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1">
                </div>
                <span id="time-display">0:00 / 0:00</span>
            </div>
            
            <div class="right-controls">
                <button id="settings-btn">âš™ï¸</button>
                <button id="fullscreen-btn">ğŸ”³</button>
            </div>
        </div>
    </div>
    
    <ul id="quality-menu" class="yt-menu"></ul>
</div>

<script>
let audioTrack = new Audio();
const video = document.getElementById('main-video');
const playBtn = document.getElementById('play-pause');
const volSlider = document.getElementById('volume-slider');
const progressArea = document.getElementById('progress-area');
const progressBar = document.getElementById('progress-bar');

async function init(videoId) {
    const res = await fetch(`https://xeroxapp032.vercel.app/api/v1/oisogi/${videoId}`);
    const data = await res.json();
    
    // åˆæœŸã‚»ãƒƒãƒˆ (æœ€é«˜ç”»è³ª & éŸ³å£°)
    video.src = data.streams.video[0].url;
    audioTrack.src = data.streams.audio[0].url;
    
    // ç”»è³ªãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆ
    const menu = document.getElementById('quality-menu');
    data.streams.video.forEach(v => {
        const li = document.createElement('li');
        li.textContent = `${v.itag}p`;
        li.onclick = () => {
            const time = video.currentTime;
            video.src = v.url;
            video.currentTime = time;
            if(!video.paused) video.play();
            menu.classList.remove('show');
        };
        menu.appendChild(li);
    });
}

// --- åŒæœŸã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ  ---
playBtn.onclick = () => {
    if(video.paused) { video.play(); audioTrack.play(); playBtn.textContent = 'â¸'; }
    else { video.pause(); audioTrack.pause(); playBtn.textContent = 'â–¶'; }
};

// ã€éŸ³é‡èª¿æ•´ã€‘ã“ã“ãŒéšŠå“¡ã®ã“ã ã‚ã‚Šãƒã‚¤ãƒ³ãƒˆï¼
volSlider.oninput = (e) => {
    const vol = e.target.value;
    video.volume = vol;      // æ˜ åƒï¼ˆä¸€å¿œï¼‰
    audioTrack.volume = vol; // æœ¬å‘½ã®éŸ³
    document.getElementById('mute-btn').textContent = vol == 0 ? 'ğŸ”‡' : 'ğŸ”Š';
};

video.ontimeupdate = () => {
    const p = (video.currentTime / video.duration) * 100;
    progressBar.style.width = p + '%';
};

// ã‚·ãƒ¼ã‚¯ï¼ˆé£›ã°ã—è¦‹ï¼‰åŒæœŸ
progressArea.onclick = (e) => {
    const rect = progressArea.getBoundingClientRect();
    const pos = (e.clientX - rect.left) / rect.width;
    video.currentTime = pos * video.duration;
    audioTrack.currentTime = video.currentTime;
};

document.getElementById('settings-btn').onclick = () => document.getElementById('quality-menu').classList.toggle('show');

// èµ·å‹•ï¼
// --- URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰IDã‚’å–å¾—ã—ã¦èµ·å‹•ã™ã‚‹æŒ‡æ®å®˜ã‚³ãƒ¼ãƒ‰ ---
(function() {
    // 1. ç¾åœ¨ã®URLã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ?v=...ï¼‰ã‚’è§£æ
    const urlParams = new URLSearchParams(window.location.search);
    
    // 2. å¤‰æ•°idsã«è¨­å®šï¼ˆã‚‚ã—ç„¡ã‹ã£ãŸã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆIDã‚’ã‚»ãƒƒãƒˆï¼‰
    const ids = urlParams.get('v') || "b2mX9Aj4wFY"; 
    
    console.log(`ğŸ“¡ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆIDè£œè¶³: ${ids}`);
    
    // 3. æŒ‡ä»¤é–‹å§‹ï¼
    if (typeof init === "function") {
        init(ids);
    } else {
        console.error("âŒ inité–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚é…ç½®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼");
    }
})();
</script>
</body>
</html>--

    <style>
        /* éšŠå“¡ã®ãƒ•ã‚©ãƒ¼ãƒ ç”¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶™æ‰¿ & èª¿æ•´ */
        body { background-color: #0f0f0f; color: #333; font-family: 'Helvetica Neue', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        
        .container { background-color: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); max-width: 800px; width: 100%; box-sizing: border-box; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #444; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1em; }
        
        button#launch-btn { background-color: #ff0000; color: white; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: bold; width: 100%; transition: background 0.3s; }
        button#launch-btn:hover { background-color: #cc0000; }

        /* --- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (æœ€åˆã¯éš ã™) --- */
        #player-section { display: none; width: 100%; margin-top: 30px; }
        .yt-container { position: relative; background: #000; border-radius: 8px; overflow: hidden; aspect-ratio: 16 / 9; }
        video { width: 100%; height: 100%; display: block; }

        /* YouTubeé¢¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆå‰å›ã®ã‚³ãƒ¼ãƒ‰ã‚’çµ±åˆï¼‰ */




        /* YouTubeé¢¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .yt-controls { position: absolute; bottom: 0; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.7)); padding: 10px; box-sizing: border-box; opacity: 0; transition: opacity 0.2s; }
        .yt-container:hover .yt-controls { opacity: 1; }
        
        .progress-area { height: 4px; background: rgba(255,255,255,0.2); margin-bottom: 10px; cursor: pointer; position: relative; }
        .progress-bar { height: 100%; background: #f00; width: 0%; }
        
        .bottom-controls { display: flex; align-items: center; justify-content: space-between; }
        .left-controls, .right-controls { display: flex; align-items: center; gap: 15px; }
        
        button { background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 5px; }
        
        /* éŸ³é‡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
        .volume-container { display: flex; align-items: center; gap: 5px; }
        #volume-slider { width: 0; transition: width 0.2s; cursor: pointer; accent-color: #fff; }
        .volume-container:hover #volume-slider { width: 60px; }
        
        .yt-menu { position: absolute; bottom: 50px; right: 10px; background: rgba(28,28,28,0.9); border-radius: 8px; padding: 10px; list-style: none; display: none; }
        .yt-menu.show { display: block; }
        .yt-menu li { padding: 8px 12px; cursor: pointer; font-size: 14px; }
        .yt-menu li:hover { background: rgba(255,255,255,0.1); }



        
        
        /* ã‚¹ãƒ”ãƒŠãƒ¼ */
        #loading-area { display: none; margin-top: 20px; text-align: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #ff0000; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


    
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸš€ Gemini ProgrammingéšŠ çµ±åˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h2>
        
        <div class="form-group">
            <label for="youtubeLink">å‹•ç”»URLã¾ãŸã¯IDã‚’å…¥åŠ›:</label>
            <input type="text" id="youtubeLink" placeholder="https://www.youtube.com/watch?v=..." value="">
        </div>

        <button id="launch-btn">æ¢æ¤œé–‹å§‹ï¼ˆã‚¹ã‚­ãƒ£ãƒ³å®Ÿè¡Œï¼‰</button>

        <div id="loading-area">
            <div class="spinner"></div>
            <p id="status-msg">ç´¢æ•µä¸­...</p>
        </div>

        <div id="player-section">
            <div class="yt-container">
                <video id="main-video" playsinline></video>
                <div class="yt-controls">
                    <div class="progress-area" id="progress-area"><div class="progress-bar" id="progress-bar"></div></div>
                    <div class="bottom-controls">
                        <div>
                            <button onclick="togglePlay()" id="play-pause" style="background:none; border:none; color:white; font-size:20px; cursor:pointer;">â–¶</button>
                            <span id="time-display" style="font-size: 12px; margin-left: 10px;">0:00 / 0:00</span>
                        </div>
                        <div>
                            <button onclick="toggleMenu()" style="background:none; border:none; color:white; cursor:pointer;">âš™ï¸</button>
                            <button id="fullscreen-btn">ğŸ”³</button>
                        </div>
                    </div>
                </div>
                <ul id="quality-menu" class="yt-menu"></ul>
            </div>
            <p style="font-size: 12px; color: #666; margin-top: 10px;">â€»éŸ³å£°ã¨æ˜ åƒã‚’è‡ªå‹•åŒæœŸã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã„ã¾ã™</p>
        </div>
    </div>

<script>
let audioTrack = new Audio();
const video = document.getElementById('main-video');
const loadingArea = document.getElementById('loading-area');
const playerSection = document.getElementById('player-section');
const statusMsg = document.getElementById('status-msg');

// 1. èµ·å‹•ãƒœã‚¿ãƒ³ã®å‡¦ç†
document.getElementById('launch-btn').onclick = () => {
    let input = document.getElementById('youtubeLink').value;
    let videoId = extractVideoId(input);
    
    if(videoId) {
        startAdventure(videoId);
    } else {
        alert("æœ‰åŠ¹ãªURLã¾ãŸã¯IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");
    }
};

function extractVideoId(url) {
    if(url.length === 11) return url;
    const match = url.match(/(?:v=|\/embed\/|\/watch\?v=|\/v\/|\/e\/|youtu\.be\/|project\/|https:\/\/www\.youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/);
    return (match && match[1]) ? match[1] : null;
}

// 2. ã‚¹ã‚­ãƒ£ãƒ³ï¼†å†ç”Ÿã®ä¸»è»¸
async function startAdventure(videoId) {
    playerSection.style.display = 'none';
    loadingArea.style.display = 'block';
    statusMsg.innerText = `ğŸ“¡ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ[${videoId}]ã‚’ç´¢æ•µä¸­...`;

    try {
        const res = await fetch(`https://xeroxapp032.vercel.app/api/v1/oisogi/${videoId}`);
        const data = await res.json();

        if(!data.streams.video.length) throw new Error("ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");

        // æˆåŠŸï¼
        loadingArea.style.display = 'none';
        playerSection.style.display = 'block';

        video.src = data.streams.video[0].url;
        audioTrack.src = data.streams.audio[0] ? data.streams.audio[0].url : "";
        
        setupMenu(data.streams.video);
        console.log("Mission Success: UI Deployed.");

    } catch (e) {
        statusMsg.innerHTML = `<span style="color:red;">ğŸ’¥ ç´¢æ•µå¤±æ•—: ${e.message}</span>`;
    }
}

// åŒæœŸã‚·ã‚¹ãƒ†ãƒ ï¼ˆå†ç”Ÿãƒ»ãƒãƒ¼ã‚ºï¼‰
function togglePlay() {
    const btn = document.getElementById('play-pause');
    if(video.paused) {
        video.play(); audioTrack.play();
        btn.textContent = 'â¸';
    } else {
        video.pause(); audioTrack.pause();
        btn.textContent = 'â–¶';
    }
}

// ç”»è³ªãƒ¡ãƒ‹ãƒ¥ãƒ¼
function setupMenu(streams) {
    const menu = document.getElementById('quality-menu');
    menu.innerHTML = '';
    streams.forEach(v => {
        const li = document.createElement('li');
        li.textContent = `${v.itag}p (Video Only)`;
        li.onclick = () => {
            const t = video.currentTime;
            video.src = v.url;
            video.currentTime = t;
            video.play();
            menu.classList.remove('show');
        };
        menu.appendChild(li);
    });
}

function toggleMenu() { document.getElementById('quality-menu').classList.toggle('show'); }

// æ™‚é–“æ›´æ–°åŒæœŸ
video.ontimeupdate = () => {
    const p = (video.currentTime / video.duration) * 100;
    document.getElementById('progress-bar').style.width = p + '%';
};

// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å³æ™‚å®Ÿè¡Œ
(function() {
    const urlParams = new URLSearchParams(window.location.search);
    const v = urlParams.get('v');
    if(v) {
        document.getElementById('youtubeLink').value = v;
        startAdventure(v);
    }
})();
async function inits(v) {
    const res = await fetch(`https://xeroxapp032.vercel.app/api/v1/${v}`);
    const data = await res.json();
    
    
    // ç”»è³ªãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆ
    const menu = document.getElementById('quality-menu');
    data.streams.video.forEach(v => {
        const li = document.createElement('li');
        li.textContent = `${v.itag}p`;
        li.onclick = () => {
            const time = video.currentTime;
            video.src = v.url;
            video.currentTime = time;
            if(!video.paused) video.play();
            menu.classList.remove('show');
        };
        menu.appendChild(li);
    });
}
</script>
</body>
</html>-->
